@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@inject NavigationManager Navigation
@inject SignOutSessionStateManager SignOutManager
@inject IDialogService DialogService

<AuthorizeView>
    <Authorized>
        <MudAvatar Size="Size.Medium">@context.User.Identity.Name.First()</MudAvatar>
        <MudIconButton Icon="@Icons.Material.Filled.Logout" Color="Color.Inherit" Edge="Edge.End" OnClick="BeginSignOut" />
    </Authorized>
    <NotAuthorized>
        <MudIconButton Icon="@Icons.Material.Filled.Login" Color="Color.Inherit" Edge="Edge.End" Link="authentication/login"/>
    </NotAuthorized>
</AuthorizeView>

@code {
    private async Task BeginSignOut(MouseEventArgs args)
    {
        var result = await DialogService.ShowMessageBox("Log out", "Are you sure?", "Yes", "No");

        if(!result.GetValueOrDefault()) 
        {
            return;
        }

        await SignOutManager.SetSignOutState();
        Navigation.NavigateTo("authentication/logout");
    }
}